@import java.time.OffsetDateTime

@import controllers.admin.CaseController
@import domain.CaseNote
@import domain.dao.CaseDao.Case
@import warwick.core.helpers.JavaTime

@(c: Case, note: CaseNote)(implicit context: RequestContext, req: RequestHeader, messagesProvider: MessagesProvider)

<div class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">
      <span class="date pull-right">
        @note.teamMember.safeFullName,
        @JavaTime.Relative(note.created)
        @if(note.lastUpdated != note.created) {
          (last updated @JavaTime.Relative(note.lastUpdated))
        }
      </span>
      @{note.noteType.description}
      @if(context.user.exists(_.usercode == note.teamMember.usercode)) {
        <a class="btn btn-xs btn-link" href="@controllers.admin.routes.CaseController.editNoteForm(c.key.get, note.id)" aria-label="Edit case note">
          @tags.icons.noteEdit()
        </a>
        @defining(CaseController.deleteForm(note.lastUpdated).fill(note.lastUpdated)) { form: Form[OffsetDateTime] =>
          @b3.inline.formCSRF(controllers.admin.routes.CaseController.deleteNote(c.key.get, note.id), 'class -> "inline-form") { implicit ifc =>
            @b3.validatedHidden(form, "version")
            <button type="submit" class="btn btn-xs btn-link" data-toggle="confirm-submit" data-message="Are you sure you want to delete this case note?" aria-label="Delete case note">
              @tags.icons.noteDelete()
            </button>
          }
        }
      }
    </h3>
  </div>
  <div class="panel-body">
    @views.utils.nl2br(note.text)
  </div>
</div>
