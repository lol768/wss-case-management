@import java.util.UUID

@import domain.{Enquiry, MessageData, SitsProfile}

@(
  title: String,
  enquiries: Seq[(Enquiry, MessageData)],
  clients: Map[UUID, Set[SitsProfile]],
  emptyMessage: Option[String] = None
)(implicit context: RequestContext)

@enquiryRow(enquiry: Enquiry, message: MessageData) = {
  <tr>
    <td>
      @clients.get(enquiry.id.get).flatMap(_.headOption).map { p: SitsProfile =>
        <a href="@controllers.admin.routes.ClientController.client(p.universityID)">@p.fullName</a>
      }.getOrElse { @enquiry.universityID }
    </td>
    <td>
      <a href="@controllers.admin.routes.TeamEnquiryController.messages(enquiry.key.get)">@enquiry.key.get.string @enquiry.subject</a>
    </td>
    <td>@helpers.JavaTime.Relative(message.created)</td>
  </tr>
}

@if(enquiries.nonEmpty) {
  <table class="table table-default">
    <caption>@title</caption>
    <thead>
      <tr>
        <th class="col-sm-3">Client</th>
        <th class="col-sm-6">Subject</th>
        <th class="col-sm-3">Last message</th>
      </tr>
    </thead>
    <tbody>
      @enquiries.map { case (enquiry, message) =>
        @enquiryRow(enquiry, message)
      }
    </tbody>
  </table>
} else {
  @emptyMessage.map { m => <p>@m</p> }
}