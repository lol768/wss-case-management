@import domain.AtRiskClient
@import domain.ClientRiskStatus
@import helpers.JavaTime
@(clients: Set[AtRiskClient], showMentalHealth: Boolean)

@if(clients.nonEmpty) {
  <table class="table table-default">
    <thead>
      <tr>
      @if(showMentalHealth) {
        <th class="col-sm-4">Client</th>
        <th class="col-sm-2"></th>
        <th class="col-sm-2"></th>
        <th class="col-sm-2">Last case updated</th>
        <th class="col-sm-2">Last enquiry updated</th>
      } else {
        <th class="col-sm-4">Client</th>
        <th class="col-sm-2"></th>
        <th class="col-sm-3">Last case updated</th>
        <th class="col-sm-3">Last enquiry updated</th>
      }
      </tr>
    </thead>
    <tbody>
    @clients.toSeq.sorted.map { case AtRiskClient(summary, lastCaseUpdated, lastEnquiryUpdated) =>
    <tr>
      <td>
        <a href="@controllers.admin.routes.ClientController.client(summary.client.universityID)">
          @summary.client.safeFullName
        </a>
      </td>
      @if(showMentalHealth) {
        <td>
        @summary.highMentalHealthRisk.filter(r => r).map { r =>
          <span class="label label-danger">High mental health risk</span>
        }
        </td>
      }
      <td>
        @summary.riskStatus.map {
          case ClientRiskStatus.Low => {
            <span class="label label-success">Low risk status</span>
          }
          case ClientRiskStatus.Medium => {
            <span class="label label-warning">Medium risk status</span>
          }
          case ClientRiskStatus.High => {
            <span class="label label-danger">High risk status</span>
          }
        }
      </td>
      <td>
        @lastCaseUpdated.map(d => JavaTime.Relative(d))
      </td>
      <td>
        @lastEnquiryUpdated.map(d => JavaTime.Relative(d))
    </td>
    </tr>
    }
    </tbody>
  </table>
} else {
  No at risk clients found.
}