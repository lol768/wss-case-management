@import services.Metric
@(
    teams: Seq[String],
    range: String,
    metrics: Seq[Metric],
    showTotal: Boolean,
    form: Form[DateRange]
)(implicit context: RequestContext, req: RequestHeader, messages: MessagesProvider)

@row(metric: Metric) = {
    <tr>
      <th class="use-tooltip" title="@metric.description.getOrElse(metric.name)">
        @metric.urlPath match {
          case Some(path) => { <a class="d3-chartable" data-src="@path/@form("start").value.getOrElse("-")/@form("end").value.getOrElse("-")">@metric.name</a> }
          case None => { @metric.name }
        }
      </th>
      
      @teams.map { case team =>
        <td class="numeric">
          @metric.teamMetrics.find(_.team.name == team).map(_.value).getOrElse("-")
        </td>
      }
      
      @if(showTotal) {
        <th class="numeric total">
        @metric.teamMetrics.map({ case tm => tm.value }).sum
        </th>
      }
    </tr>
}
  
@main("Reports") {
  <div class="well">
    @b3.vertical.formCSRF(action = controllers.reports.routes.ReportsController.report) { implicit ifc =>
      @if(form.hasGlobalErrors) {
        @defining(form.globalErrors.map(_.message).mkString(", ")) { error =>
          @b3.datePicker(form("start"), '_label -> "Start", '_error -> true)
          @b3.datePicker(form("end"), '_label -> "End", '_error -> error)
        }
      } else {
        @b3.datePicker(form("start"), '_label -> "Start", '_label -> "Start")
        @b3.datePicker(form("end"), '_label -> "End", '_label -> "End")
      }
  
      @b3.submit('class -> "btn btn-primary") { Update report }
    }
  </div>
  
  <div id="d3-chart-container" class="d3-chart-container collapsed">
    <i class="d3-hider pull-right far fa-2x fa-times text-muted" title="Hide chart"></i>
    <div id="d3-chart"></div>
  </div>
  
  <table class="table table-default">
    <caption>@range</caption>
    <thead>
      <tr>
        <th></th>
        
        @teams.map { case team => <th class="numeric">@team</th> }
        
        @if(showTotal) {
          <th class="numeric total">Total</th>
        }
      </tr>
    </thead>
    
    <tbody>
      @metrics.map { case metric => @row(metric) }
    </tbody>
  </table>
}
